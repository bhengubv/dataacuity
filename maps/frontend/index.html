<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Data Acuity Maps - Navigate Anywhere</title>

    <!-- Preconnect for faster loading -->
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <link rel="dns-prefetch" href="https://unpkg.com">

    <!-- SEO Meta Tags -->
    <meta name="description" content="Navigate anywhere with Data Acuity Maps. Get directions, find nearby places, and explore with real-time navigation.">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.json">

    <!-- Open Graph -->
    <meta property="og:title" content="Data Acuity Maps">
    <meta property="og:description" content="Navigate anywhere. Get directions, find places, explore.">
    <meta property="og:image" content="https://maps.dataacuity.co.za/images/og-image.png">
    <meta property="og:url" content="https://maps.dataacuity.co.za/">

    <!-- MapLibre GL CSS -->
    <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@4.1.0/dist/maplibre-gl.css">
    <link rel="preload" href="https://unpkg.com/maplibre-gl@4.1.0/dist/maplibre-gl.js" as="script">

    <!-- Critical CSS - Mobile First -->
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html, body {
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a2e;
            overflow: hidden;
            touch-action: manipulation;
        }

        /* Full screen map */
        #map {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 1;
        }

        /* Search pill - Waze style */
        .search-pill {
            position: fixed;
            top: 16px;
            left: 16px;
            right: 16px;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .search-box {
            flex: 1;
            display: flex;
            align-items: center;
            background: white;
            border-radius: 32px;
            padding: 22px 34px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.15);
            cursor: pointer;
            min-height: 84px;
        }

        .search-box:active {
            transform: scale(0.98);
        }

        .search-icon {
            font-size: 28px;
            margin-right: 16px;
            color: #666;
        }

        .search-text {
            flex: 1;
            font-size: 26px;
            color: #333;
            font-weight: 500;
        }

        .search-text span {
            color: #999;
            font-weight: 400;
        }

        .menu-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: white;
            border: none;
            box-shadow: 0 2px 12px rgba(0,0,0,0.15);
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-btn:active {
            transform: scale(0.95);
        }

        /* Bottom action bar */
        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: white;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -2px 20px rgba(0,0,0,0.1);
            padding: 16px 8px;
            padding-bottom: max(16px, env(safe-area-inset-bottom));
        }

        .quick-actions {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .quick-action {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 12px;
            min-width: 64px;
        }

        .quick-action:active {
            background: #f0f0f0;
        }

        .quick-action-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .quick-action-icon.home { background: #e3f2fd; }
        .quick-action-icon.work { background: #fce4ec; }
        .quick-action-icon.gas { background: #fff3e0; }
        .quick-action-icon.food { background: #e8f5e9; }
        .quick-action-icon.more { background: #f3e5f5; }

        .quick-action-label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }

        /* Locate me FAB */
        .fab-locate {
            position: fixed;
            right: 16px;
            bottom: 140px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: white;
            border: none;
            box-shadow: 0 2px 12px rgba(0,0,0,0.2);
            font-size: 24px;
            cursor: pointer;
            z-index: 99;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab-locate:active {
            transform: scale(0.95);
            background: #e3f2fd;
        }

        .fab-locate.locating {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 2px 12px rgba(0,0,0,0.2); }
            50% { box-shadow: 0 2px 20px rgba(33,150,243,0.5); }
        }

        /* User location marker */
        .user-marker {
            width: 24px;
            height: 24px;
            background: #2196F3;
            border: 3px solid white;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(33,150,243,0.5);
        }

        .user-marker-pulse {
            position: absolute;
            width: 80px;
            height: 80px;
            background: rgba(33,150,243,0.2);
            border-radius: 50%;
            animation: marker-pulse 2s infinite;
            transform: translate(-50%, -50%);
            left: 50%;
            top: 50%;
            z-index: -1;
        }

        @keyframes marker-pulse {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
        }

        /* Full screen search overlay */
        /* Waze-style search - backdrop dims the map */
        .search-backdrop {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.4);
            z-index: 199;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .search-backdrop.active {
            opacity: 1;
            visibility: visible;
        }

        /* Bottom sheet that slides up */
        .search-overlay {
            position: fixed;
            left: 0; right: 0; bottom: 0;
            background: white;
            z-index: 200;
            border-radius: 24px 24px 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            height: 75vh;
            display: flex;
            flex-direction: column;
        }

        .search-overlay.active {
            transform: translateY(0);
        }

        /* Drag handle at top of sheet */
        .search-drag-handle {
            width: 40px;
            height: 4px;
            background: #ddd;
            border-radius: 2px;
            margin: 12px auto 8px;
        }

        .search-header {
            display: flex;
            align-items: center;
            padding: 8px 16px 16px;
            gap: 12px;
        }

        .search-back {
            width: 44px;
            height: 44px;
            border: none;
            background: #f0f0f0;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .search-input-wrapper {
            flex: 1;
            position: relative;
        }

        #search-input {
            width: 100%;
            padding: 18px 24px;
            border: none;
            font-size: 20px;
            outline: none;
            background: #f5f5f5;
            border-radius: 16px;
            min-height: 60px;
            box-sizing: border-box;
        }

        #search-input::placeholder {
            color: #999;
        }

        .search-clear {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 28px;
            height: 28px;
            border: none;
            background: #ccc;
            border-radius: 50%;
            color: white;
            font-size: 16px;
            cursor: pointer;
            display: none;
        }

        .search-clear.visible {
            display: block;
        }

        .search-body {
            flex: 1 1 auto;
            overflow-y: auto;
            padding: 0 16px 16px;
            padding-bottom: max(16px, env(safe-area-inset-bottom));
            min-height: 0;
        }

        .search-section {
            margin-bottom: 24px;
        }

        .search-section-title {
            font-size: 13px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 12px;
        }

        .saved-places {
            display: flex;
            gap: 12px;
        }

        .saved-place {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 16px;
            background: #f8f8f8;
            border-radius: 16px;
            border: none;
            cursor: pointer;
            min-width: 100px;
        }

        .saved-place:active {
            background: #eee;
        }

        .saved-place-icon {
            font-size: 28px;
        }

        .saved-place-label {
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }

        .saved-place-address {
            font-size: 12px;
            color: #999;
        }

        .category-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .category-chip {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: #f0f0f0;
            border-radius: 24px;
            border: none;
            cursor: pointer;
            font-size: 15px;
        }

        .category-chip:active {
            background: #e0e0e0;
        }

        .search-results {
            background: #fff;
            padding: 8px 0;
        }

        .search-result {
            display: flex;
            align-items: center;
            padding: 18px 12px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            border-radius: 12px;
            margin: 4px 0;
        }

        .search-result:hover {
            background: #f8f8f8;
        }

        .search-result:active {
            background: #f8f8f8;
        }

        .result-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            margin-right: 14px;
        }

        .result-info {
            flex: 1;
        }

        .result-name {
            font-size: 18px;
            font-weight: 500;
            color: #333;
        }

        .result-address {
            font-size: 15px;
            color: #666;
            margin-top: 4px;
        }

        /* Navigation panel */
        .nav-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            z-index: 150;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            max-height: 70vh;
            display: flex;
            flex-direction: column;
        }

        .nav-panel.active {
            transform: translateY(0);
        }

        .nav-panel-header {
            padding: 16px;
            border-bottom: 1px solid #eee;
        }

        .nav-panel-drag {
            width: 40px;
            height: 4px;
            background: #ddd;
            border-radius: 2px;
            margin: 0 auto 12px;
        }

        .nav-destination {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-destination-icon {
            width: 48px;
            height: 48px;
            background: #e3f2fd;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .nav-destination-info h3 {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .nav-destination-info p {
            font-size: 14px;
            color: #666;
        }

        .nav-panel-actions {
            display: flex;
            gap: 12px;
            padding: 16px;
        }

        .nav-action-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .nav-action-btn.primary {
            background: #2196F3;
            color: white;
        }

        .nav-action-btn.secondary {
            background: #f0f0f0;
            color: #333;
        }

        .nav-action-btn:active {
            opacity: 0.9;
            transform: scale(0.98);
        }

        /* Directions List */
        .directions-list {
            display: none;
            flex: 1;
            overflow-y: auto;
            padding: 0 16px 16px;
            max-height: 50vh;
        }

        .directions-list.active {
            display: block;
        }

        .directions-summary {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            margin-bottom: 8px;
        }

        .directions-summary-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .directions-time {
            font-size: 24px;
            font-weight: 700;
            color: #2196F3;
        }

        .directions-distance {
            font-size: 16px;
            color: #666;
        }

        .directions-step {
            display: flex;
            align-items: flex-start;
            padding: 12px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .directions-step:last-child {
            border-bottom: none;
        }

        .directions-step-icon {
            width: 36px;
            height: 36px;
            background: #f0f0f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .directions-step-icon.depart { background: #e8f5e9; }
        .directions-step-icon.arrive { background: #ffebee; }
        .directions-step-icon.turn { background: #e3f2fd; }

        .directions-step-content {
            flex: 1;
        }

        .directions-step-instruction {
            font-size: 15px;
            color: #333;
            font-weight: 500;
        }

        .directions-step-detail {
            font-size: 13px;
            color: #888;
            margin-top: 4px;
        }

        .directions-step-distance {
            font-size: 13px;
            color: #666;
            margin-left: 8px;
            white-space: nowrap;
        }

        .directions-step.current-step {
            background: #e3f2fd;
            margin: 0 -16px;
            padding: 12px 16px;
            border-radius: 12px;
            border-bottom: none;
        }

        .directions-step.current-step .directions-step-icon {
            background: #2196F3;
            color: white;
        }

        .directions-step.current-step .directions-step-instruction {
            color: #1565C0;
            font-weight: 600;
        }

        /* Menu panel */
        .menu-panel {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 300px;
            background: white;
            z-index: 300;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .menu-panel.active {
            transform: translateX(0);
        }

        .menu-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 299;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }

        .menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .menu-header {
            padding: 24px 20px;
            padding-top: max(24px, env(safe-area-inset-top));
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
        }

        .menu-header h2 {
            font-size: 20px;
            font-weight: 600;
        }

        .menu-header p {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 4px;
        }

        .menu-items {
            flex: 1;
            overflow-y: auto;
            padding: 12px 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 20px;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-size: 16px;
            color: #333;
        }

        .menu-item:active {
            background: #f5f5f5;
        }

        .menu-item-icon {
            font-size: 22px;
            width: 28px;
            text-align: center;
        }

        .menu-divider {
            height: 1px;
            background: #eee;
            margin: 8px 0;
        }

        /* Settings Panel - Waze Style */
        .settings-backdrop {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.4);
            z-index: 299;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .settings-backdrop.active {
            opacity: 1;
            visibility: visible;
        }

        .settings-panel {
            position: fixed;
            left: 0; right: 0; bottom: 0;
            background: #f5f5f5;
            z-index: 300;
            border-radius: 24px 24px 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            height: 85vh;
            display: flex;
            flex-direction: column;
        }

        .settings-panel.active {
            transform: translateY(0);
        }

        .settings-header {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            background: white;
            border-radius: 24px 24px 0 0;
            border-bottom: 1px solid #eee;
        }

        .settings-back {
            width: 44px;
            height: 44px;
            border: none;
            background: #f0f0f0;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
        }

        .settings-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        .settings-body {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            padding-bottom: max(16px, env(safe-area-inset-bottom));
        }

        .settings-section {
            background: white;
            border-radius: 16px;
            margin-bottom: 16px;
            overflow: hidden;
        }

        .settings-section-title {
            font-size: 13px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            padding: 16px 20px 8px;
        }

        .settings-item {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-item:active {
            background: #f8f8f8;
        }

        .settings-item-icon {
            font-size: 24px;
            width: 40px;
            text-align: center;
            margin-right: 16px;
        }

        .settings-item-content {
            flex: 1;
        }

        .settings-item-label {
            font-size: 16px;
            font-weight: 500;
            color: #333;
        }

        .settings-item-value {
            font-size: 14px;
            color: #666;
            margin-top: 2px;
        }

        .settings-item-arrow {
            font-size: 18px;
            color: #ccc;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 52px;
            height: 32px;
            flex-shrink: 0;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #ccc;
            transition: 0.3s;
            border-radius: 32px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 3px;
            bottom: 3px;
            background: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch input:checked + .toggle-slider {
            background: #2196F3;
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        /* Radio Options */
        .settings-radio-group {
            padding: 8px 20px 16px;
        }

        .settings-radio {
            display: flex;
            align-items: center;
            padding: 12px 0;
            cursor: pointer;
        }

        .settings-radio input {
            display: none;
        }

        .settings-radio-mark {
            width: 22px;
            height: 22px;
            border: 2px solid #ccc;
            border-radius: 50%;
            margin-right: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
        }

        .settings-radio input:checked + .settings-radio-mark {
            border-color: #2196F3;
        }

        .settings-radio input:checked + .settings-radio-mark:after {
            content: "";
            width: 12px;
            height: 12px;
            background: #2196F3;
            border-radius: 50%;
        }

        .settings-radio-label {
            font-size: 16px;
            color: #333;
        }

        /* Utility */
        .hidden { display: none !important; }

        /* Loading state */
        .loading-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #1a1a2e;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            transition: opacity 0.5s ease;
        }

        .loading-overlay.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 3px solid rgba(255,255,255,0.2);
            border-top-color: #2196F3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 16px;
            font-size: 16px;
            opacity: 0.8;
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 140px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #333;
            color: white;
            padding: 14px 24px;
            border-radius: 28px;
            font-size: 15px;
            z-index: 400;
            opacity: 0;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Responsive adjustments */
        @media (min-width: 768px) {
            .search-pill {
                max-width: 600px;
                left: 50%;
                transform: translateX(-50%);
                right: auto;
            }

            .bottom-bar {
                max-width: 500px;
                left: 50%;
                transform: translateX(-50%);
                border-radius: 20px;
                margin-bottom: 20px;
            }

            .fab-locate {
                bottom: 160px;
            }
        }

        /* Incident Report Panel */
        .report-panel {
            position: fixed;
            left: 0; right: 0; bottom: 0;
            background: #f5f5f5;
            z-index: 300;
            border-radius: 24px 24px 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            max-height: 70vh;
            display: flex;
            flex-direction: column;
        }

        .report-panel.active {
            transform: translateY(0);
        }

        .report-header {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            background: white;
            border-radius: 24px 24px 0 0;
            border-bottom: 1px solid #eee;
        }

        .report-back {
            width: 44px;
            height: 44px;
            border: none;
            background: #f0f0f0;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
        }

        .report-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        .report-body {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            padding-bottom: max(16px, env(safe-area-inset-bottom));
        }

        .report-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .report-type {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 16px;
            padding: 20px 12px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .report-type:active {
            transform: scale(0.95);
        }

        .report-type.selected {
            border-color: #007AFF;
            background: #E8F4FF;
        }

        .report-type-icon {
            font-size: 36px;
            margin-bottom: 8px;
        }

        .report-type-label {
            font-size: 13px;
            font-weight: 500;
        }

        /* Map Layers Panel */
        .layers-panel {
            position: fixed;
            left: 0; right: 0; bottom: 0;
            background: #f5f5f5;
            z-index: 300;
            border-radius: 24px 24px 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        .layers-panel.active {
            transform: translateY(0);
        }

        .layers-header {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            background: white;
            border-radius: 24px 24px 0 0;
            border-bottom: 1px solid #eee;
        }

        .layers-back {
            width: 44px;
            height: 44px;
            border: none;
            background: #f0f0f0;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
        }

        .layers-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        .layers-body {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            padding-bottom: max(16px, env(safe-area-inset-bottom));
        }

        .layers-section {
            margin-bottom: 24px;
        }

        .layers-section-title {
            font-size: 14px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 12px;
            padding-left: 4px;
        }

        .layers-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .layer-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            border-radius: 16px;
            padding: 12px 8px;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .layer-option:active {
            transform: scale(0.95);
        }

        .layer-option.selected {
            border-color: #007AFF;
            background: #E8F4FF;
        }

        .layer-preview {
            width: 80px;
            height: 60px;
            border-radius: 8px;
            margin-bottom: 8px;
            background-size: cover;
            background-position: center;
            border: 1px solid #e0e0e0;
        }

        .layer-preview.streets { background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 50%, #f0f0f0 100%); }
        .layer-preview.satellite { background: linear-gradient(135deg, #2d5016 0%, #1a3a0f 50%, #0d2a1a 100%); }
        .layer-preview.dark { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); }
        .layer-preview.local { background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 50%, #ffcc80 100%); }
        .layer-preview.terrain { background: linear-gradient(135deg, #c8e6c9 0%, #a5d6a7 50%, #81c784 100%); }
        .layer-preview.hybrid { background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 50%, #388e3c 100%); }

        .layer-name {
            font-size: 12px;
            font-weight: 500;
            color: #333;
            text-align: center;
        }

        .layer-badge {
            font-size: 9px;
            background: #4CAF50;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            margin-top: 4px;
        }

        .layers-toggles {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .layer-toggle {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 12px;
            padding: 14px 16px;
            cursor: pointer;
        }

        .layer-toggle-icon {
            font-size: 24px;
            margin-right: 14px;
        }

        .layer-toggle-content {
            flex: 1;
        }

        .layer-toggle-label {
            font-size: 15px;
            font-weight: 500;
            color: #333;
        }

        .layer-toggle-desc {
            font-size: 12px;
            color: #888;
            margin-top: 2px;
            color: #333;
            text-align: center;
        }

        /* Historical Timeline Panel */
        .timeline-panel {
            position: fixed;
            left: 0; right: 0; bottom: 0;
            background: #1a1a2e;
            z-index: 300;
            border-radius: 24px 24px 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            color: white;
        }

        .timeline-panel.active {
            transform: translateY(0);
        }

        .timeline-header {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            background: #16213e;
            border-radius: 24px 24px 0 0;
            border-bottom: 1px solid #0f3460;
        }

        .timeline-back {
            width: 44px;
            height: 44px;
            border: none;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            font-size: 20px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
        }

        .timeline-title {
            font-size: 20px;
            font-weight: 600;
        }

        .timeline-body {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            padding-bottom: max(16px, env(safe-area-inset-bottom));
        }

        .timeline-slider-container {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .timeline-year-display {
            text-align: center;
            margin-bottom: 16px;
        }

        .timeline-year {
            font-size: 48px;
            font-weight: 700;
            color: #e94560;
        }

        .timeline-year-suffix {
            font-size: 20px;
            color: #888;
            margin-left: 8px;
        }

        .timeline-period {
            font-size: 14px;
            color: #aaa;
            margin-top: 4px;
        }

        .timeline-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, #0f3460, #e94560);
            border-radius: 4px;
            outline: none;
        }

        .timeline-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .timeline-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
            font-size: 10px;
            color: #666;
        }

        .timeline-maps-section {
            margin-top: 16px;
        }

        .timeline-section-title {
            font-size: 13px;
            font-weight: 600;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .timeline-maps-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .timeline-map-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .timeline-map-card:active {
            transform: scale(0.97);
        }

        .timeline-map-card.selected {
            border-color: #e94560;
        }

        .timeline-map-thumb {
            width: 100%;
            height: 80px;
            object-fit: cover;
            background: #333;
        }

        .timeline-map-info {
            padding: 10px;
        }

        .timeline-map-title {
            font-size: 12px;
            font-weight: 600;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .timeline-map-period {
            font-size: 10px;
            color: #888;
            margin-top: 2px;
        }

        .timeline-overlay-controls {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 16px;
            margin-top: 16px;
        }

        .timeline-control-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .timeline-control-label {
            font-size: 14px;
            color: #aaa;
        }

        .timeline-opacity-slider {
            flex: 1;
            margin: 0 16px;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            outline: none;
        }

        .timeline-opacity-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #e94560;
            cursor: pointer;
        }

        .timeline-opacity-value {
            font-size: 14px;
            color: white;
            min-width: 40px;
            text-align: right;
        }

        .timeline-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .timeline-action-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .timeline-clear-btn {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .timeline-apply-btn {
            background: #e94560;
            color: white;
        }

        .timeline-action-btn:active {
            transform: scale(0.97);
        }

        /* Timeline floating indicator when overlay is active */
        .timeline-indicator {
            position: fixed;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(26, 26, 46, 0.95);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 13px;
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 150;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .timeline-indicator.active {
            display: flex;
        }

        .timeline-indicator-year {
            font-weight: 700;
            color: #e94560;
        }

        .timeline-indicator-close {
            width: 24px;
            height: 24px;
            border: none;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            color: white;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Transit Overlay Panel */
        .transit-panel {
            position: fixed;
            left: 0; right: 0; bottom: 0;
            background: white;
            z-index: 300;
            border-radius: 24px 24px 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
        }

        .transit-panel.active {
            transform: translateY(0);
        }

        .transit-header {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            background: #4CAF50;
            border-radius: 24px 24px 0 0;
            color: white;
        }

        .transit-back {
            width: 44px;
            height: 44px;
            border: none;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            font-size: 20px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
        }

        .transit-title {
            font-size: 20px;
            font-weight: 600;
        }

        .transit-body {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            padding-bottom: max(16px, env(safe-area-inset-bottom));
        }

        .transit-search-box {
            background: #f5f5f5;
            border-radius: 12px;
            padding: 14px 16px;
            margin-bottom: 16px;
        }

        .transit-search-input {
            width: 100%;
            border: none;
            background: transparent;
            font-size: 16px;
            outline: none;
        }

        .transit-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .transit-tab {
            padding: 10px 16px;
            background: #f0f0f0;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .transit-tab.active {
            background: #4CAF50;
            color: white;
        }

        .transit-stop-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .transit-stop-card {
            display: flex;
            align-items: center;
            background: #f9f9f9;
            border-radius: 12px;
            padding: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .transit-stop-card:active {
            transform: scale(0.98);
            background: #f0f0f0;
        }

        .transit-stop-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 14px;
        }

        .transit-stop-icon.bus { background: #2196F3; color: white; }
        .transit-stop-icon.train { background: #9C27B0; color: white; }
        .transit-stop-icon.taxi { background: #FF9800; color: white; }
        .transit-stop-icon.airport { background: #607D8B; color: white; }

        .transit-stop-info {
            flex: 1;
        }

        .transit-stop-name {
            font-size: 15px;
            font-weight: 600;
            color: #333;
        }

        .transit-stop-meta {
            font-size: 13px;
            color: #666;
            margin-top: 2px;
        }

        .transit-stop-distance {
            font-size: 13px;
            color: #4CAF50;
            font-weight: 500;
        }

        .transit-route-card {
            background: white;
            border: 1px solid #eee;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .transit-route-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .transit-route-time {
            font-size: 24px;
            font-weight: 700;
            color: #333;
        }

        .transit-route-duration {
            font-size: 14px;
            color: #666;
        }

        .transit-route-steps {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .transit-route-step {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .transit-step-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .transit-step-walk { background: #e8e8e8; }
        .transit-step-bus { background: #2196F3; color: white; }
        .transit-step-train { background: #9C27B0; color: white; }
        .transit-step-taxi { background: #FF9800; color: white; }

        .transit-step-details {
            flex: 1;
        }

        .transit-step-line {
            font-weight: 600;
            color: #333;
        }

        .transit-step-info {
            font-size: 13px;
            color: #666;
        }

        .transit-empty {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .transit-empty-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .transit-loading {
            text-align: center;
            padding: 30px;
            color: #666;
        }

        /* Region Download Panel */
        .region-panel {
            position: fixed;
            left: 0; right: 0; bottom: 0;
            background: white;
            z-index: 300;
            border-radius: 24px 24px 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
        }

        .region-panel.active {
            transform: translateY(0);
        }

        .region-header {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            background: #673AB7;
            border-radius: 24px 24px 0 0;
            color: white;
        }

        .region-back {
            width: 44px;
            height: 44px;
            border: none;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            font-size: 20px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
        }

        .region-title {
            font-size: 20px;
            font-weight: 600;
        }

        .region-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: max(20px, env(safe-area-inset-bottom));
        }

        .region-info-box {
            background: #f5f5f5;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .region-info-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .region-info-text {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }

        .region-presets {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .region-preset {
            background: #f5f5f5;
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .region-preset:active {
            transform: scale(0.97);
        }

        .region-preset.selected {
            border-color: #673AB7;
            background: #EDE7F6;
        }

        .region-preset-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .region-preset-name {
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }

        .region-preset-size {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .region-draw-btn {
            width: 100%;
            padding: 16px;
            background: #673AB7;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 16px;
        }

        .region-draw-btn:active {
            background: #5E35B1;
        }

        .region-download-info {
            background: #EDE7F6;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            display: none;
        }

        .region-download-info.active {
            display: block;
        }

        .region-stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .region-stat-label {
            color: #666;
        }

        .region-stat-value {
            font-weight: 600;
            color: #333;
        }

        .region-download-btn {
            width: 100%;
            padding: 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: none;
        }

        .region-download-btn.active {
            display: block;
        }

        .region-download-btn:disabled {
            background: #ccc;
        }

        /* Drawing mode indicator */
        .region-draw-mode {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(103, 58, 183, 0.95);
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 500;
            z-index: 400;
            display: none;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .region-draw-mode.active {
            display: flex;
        }

        .region-draw-cancel {
            background: rgba(255,255,255,0.3);
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
        }

        /* Fuel Prices Panel */
        .fuel-panel {
            position: fixed;
            left: 0; right: 0; bottom: 0;
            background: white;
            z-index: 300;
            border-radius: 24px 24px 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
        }

        .fuel-panel.active {
            transform: translateY(0);
        }

        .fuel-header {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            background: #FF9800;
            border-radius: 24px 24px 0 0;
            color: white;
        }

        .fuel-back {
            width: 44px;
            height: 44px;
            border: none;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            font-size: 20px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
        }

        .fuel-title {
            font-size: 20px;
            font-weight: 600;
        }

        .fuel-body {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            padding-bottom: max(16px, env(safe-area-inset-bottom));
        }

        .fuel-type-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .fuel-type-tab {
            padding: 10px 16px;
            background: #f0f0f0;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .fuel-type-tab.active {
            background: #FF9800;
            color: white;
        }

        .fuel-station-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .fuel-station-card {
            background: #f9f9f9;
            border-radius: 16px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .fuel-station-card:active {
            transform: scale(0.98);
        }

        .fuel-station-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .fuel-station-info {
            flex: 1;
        }

        .fuel-station-name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .fuel-station-brand {
            font-size: 13px;
            color: #666;
            margin-top: 2px;
        }

        .fuel-station-distance {
            font-size: 14px;
            font-weight: 600;
            color: #FF9800;
        }

        .fuel-prices-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .fuel-price-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            background: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 13px;
        }

        .fuel-price-type {
            color: #666;
        }

        .fuel-price-value {
            font-weight: 700;
            color: #333;
        }

        .fuel-price-value.no-data {
            color: #999;
            font-weight: 400;
        }

        .fuel-station-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #eee;
        }

        .fuel-updated {
            font-size: 12px;
            color: #999;
        }

        .fuel-report-btn {
            background: #FF9800;
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
        }

        .fuel-empty {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .fuel-empty-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        /* Fuel Price Report Modal */
        .fuel-report-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 400;
            padding: 20px;
        }

        .fuel-report-modal.active {
            display: flex;
        }

        .fuel-report-content {
            background: white;
            border-radius: 20px;
            padding: 24px;
            width: 100%;
            max-width: 340px;
        }

        .fuel-report-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .fuel-report-input-group {
            margin-bottom: 16px;
        }

        .fuel-report-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
            display: block;
        }

        .fuel-report-input {
            width: 100%;
            padding: 14px;
            border: 2px solid #eee;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
        }

        .fuel-report-input:focus {
            outline: none;
            border-color: #FF9800;
        }

        .fuel-report-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .fuel-report-cancel {
            flex: 1;
            padding: 14px;
            background: #f0f0f0;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
        }

        .fuel-report-submit {
            flex: 1;
            padding: 14px;
            background: #FF9800;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
        }

        /* POI Photo Upload */
        .poi-photo-section {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #eee;
        }

        .poi-photos-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .poi-photo-thumb {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
        }

        .poi-photo-add {
            width: 100%;
            aspect-ratio: 1;
            border: 2px dashed #ddd;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: #f9f9f9;
            color: #888;
            font-size: 12px;
            transition: all 0.2s;
        }

        .poi-photo-add:hover {
            border-color: #007AFF;
            background: #f0f7ff;
            color: #007AFF;
        }

        .poi-photo-add-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }

        /* Photo Viewer Modal */
        .photo-viewer-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 500;
        }

        .photo-viewer-modal.active {
            display: flex;
        }

        .photo-viewer-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 44px;
            height: 44px;
            border: none;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .photo-viewer-img {
            max-width: 95%;
            max-height: 85vh;
            object-fit: contain;
            border-radius: 8px;
        }

        /* Carpool/Ride Share Panel */
        .rideshare-panel {
            position: fixed;
            left: 0; right: 0; bottom: 0;
            background: white;
            z-index: 300;
            border-radius: 24px 24px 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
        }

        .rideshare-panel.active {
            transform: translateY(0);
        }

        .rideshare-header {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            background: #000;
            border-radius: 24px 24px 0 0;
            color: white;
        }

        .rideshare-back {
            width: 44px;
            height: 44px;
            border: none;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            font-size: 20px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
        }

        .rideshare-title {
            font-size: 20px;
            font-weight: 600;
        }

        .rideshare-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: max(20px, env(safe-area-inset-bottom));
        }

        .rideshare-destination {
            background: #f5f5f5;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .rideshare-dest-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }

        .rideshare-dest-name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .rideshare-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .rideshare-option {
            display: flex;
            align-items: center;
            background: #f9f9f9;
            border-radius: 16px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .rideshare-option:active {
            transform: scale(0.98);
        }

        .rideshare-option.selected {
            border-color: #000;
            background: #f0f0f0;
        }

        .rideshare-logo {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 14px;
        }

        .rideshare-logo.uber { background: #000; color: white; }
        .rideshare-logo.bolt { background: #34D186; color: white; }
        .rideshare-logo.indrive { background: #C5FF3B; color: #000; }
        .rideshare-logo.taxi { background: #FFD700; color: #000; }

        .rideshare-info {
            flex: 1;
        }

        .rideshare-name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .rideshare-eta {
            font-size: 13px;
            color: #666;
            margin-top: 2px;
        }

        .rideshare-price {
            text-align: right;
        }

        .rideshare-price-value {
            font-size: 18px;
            font-weight: 700;
            color: #333;
        }

        .rideshare-price-range {
            font-size: 12px;
            color: #666;
        }

        .rideshare-cta {
            margin-top: 20px;
        }

        .rideshare-book-btn {
            width: 100%;
            padding: 16px;
            background: #000;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .rideshare-book-btn:active {
            background: #333;
        }

        .rideshare-note {
            text-align: center;
            font-size: 12px;
            color: #888;
            margin-top: 16px;
        }

        .report-submit {
            width: 100%;
            padding: 16px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            margin-top: 16px;
            cursor: pointer;
        }

        .report-submit:disabled {
            background: #ccc;
        }

        .report-submit:active:not(:disabled) {
            background: #0056b3;
        }

        /* Incident markers on map */
        .incident-marker {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .incident-marker:hover {
            transform: scale(1.1);
        }

        .incident-marker.police { background: #2196F3; }
        .incident-marker.accident { background: #f44336; }
        .incident-marker.hazard { background: #FF9800; }
        .incident-marker.traffic { background: #9C27B0; }
        .incident-marker.closure { background: #E91E63; }
        .incident-marker.construction { background: #795548; }
        .incident-marker.speed_camera { background: #000000; }
        .incident-marker.red_light { background: #D32F2F; }

        /* Camera alert styling */
        .camera-alert {
            position: fixed;
            top: 200px;
            left: 16px;
            right: 16px;
            background: linear-gradient(135deg, #1a1a1a 0%, #333 100%);
            border: 2px solid #FFD600;
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            z-index: 260;
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateY(-150%);
            transition: transform 0.3s ease-out;
        }

        .camera-alert.show {
            transform: translateY(0);
        }

        .camera-alert-icon {
            font-size: 36px;
            animation: pulse-camera 1s infinite;
        }

        @keyframes pulse-camera {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .camera-alert-content {
            flex: 1;
        }

        .camera-alert-title {
            font-weight: 700;
            font-size: 18px;
            color: #FFD600;
        }

        .camera-alert-speed {
            font-size: 28px;
            font-weight: 800;
            color: white;
            margin: 4px 0;
        }

        .camera-alert-distance {
            font-size: 14px;
            color: #aaa;
        }

        .camera-alert-close {
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            font-size: 18px;
            color: white;
            cursor: pointer;
        }

        .incident-popup {
            padding: 12px;
            min-width: 180px;
        }

        .incident-popup-title {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
        }

        .incident-popup-time {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
        }

        .incident-popup-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .incident-confirm-btn, .incident-dismiss-btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
        }

        .incident-confirm-btn {
            background: #4CAF50;
            color: white;
        }

        .incident-dismiss-btn {
            background: #f0f0f0;
            color: #666;
        }

        /* Incident alert toast */
        .incident-alert {
            position: fixed;
            top: 200px;
            left: 16px;
            right: 16px;
            background: white;
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            z-index: 250;
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateY(-150%);
            transition: transform 0.3s ease-out;
        }

        .incident-alert.show {
            transform: translateY(0);
        }

        .incident-alert-icon {
            font-size: 32px;
        }

        .incident-alert-content {
            flex: 1;
        }

        .incident-alert-title {
            font-weight: 600;
            font-size: 16px;
            color: #333;
        }

        .incident-alert-distance {
            font-size: 14px;
            color: #666;
        }

        .incident-alert-close {
            width: 32px;
            height: 32px;
            border: none;
            background: #f0f0f0;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
        }

        /* Report FAB */
        .fab-report {
            position: fixed;
            right: 16px;
            bottom: 180px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: #FF6B00;
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(255, 107, 0, 0.4);
            font-size: 24px;
            cursor: pointer;
            z-index: 90;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab-report:active {
            transform: scale(0.95);
        }

        /* Traffic Legend */
        .traffic-legend {
            position: fixed;
            bottom: 100px;
            left: 16px;
            background: white;
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.15);
            z-index: 90;
            display: none;
            font-size: 12px;
        }

        .traffic-legend.show {
            display: block;
        }

        .traffic-legend-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .traffic-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .traffic-legend-color {
            width: 24px;
            height: 4px;
            border-radius: 2px;
        }

        .traffic-legend-color.free { background: #00C853; }
        .traffic-legend-color.moderate { background: #FFD600; }
        .traffic-legend-color.heavy { background: #FF6D00; }
        .traffic-legend-color.severe { background: #D50000; }

        .traffic-legend-label {
            color: #666;
        }

        /* Traffic FAB */
        .fab-traffic {
            position: fixed;
            right: 16px;
            bottom: 244px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: white;
            border: none;
            box-shadow: 0 2px 12px rgba(0,0,0,0.15);
            font-size: 20px;
            cursor: pointer;
            z-index: 90;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab-traffic.active {
            background: #00C853;
            color: white;
        }

        .fab-traffic:active {
            transform: scale(0.95);
        }

        /* Saved Routes Panel */
        .saved-routes-panel {
            position: fixed;
            left: 0; right: 0; bottom: 0;
            background: white;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            z-index: 180;
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            max-height: 70vh;
            overflow-y: auto;
        }

        .saved-routes-panel.active {
            transform: translateY(0);
        }

        .saved-routes-header {
            display: flex;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid #eee;
            position: sticky;
            top: 0;
            background: white;
        }

        .saved-routes-back {
            width: 40px;
            height: 40px;
            border: none;
            background: none;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .saved-routes-title {
            flex: 1;
            font-size: 18px;
            font-weight: 600;
        }

        .saved-routes-body {
            padding: 8px;
        }

        .saved-routes-empty {
            text-align: center;
            padding: 40px 20px;
            display: none;
        }

        .saved-routes-empty.show {
            display: block;
        }

        .saved-routes-empty .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .saved-routes-empty .empty-text {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .saved-routes-empty .empty-hint {
            font-size: 14px;
            color: #666;
        }

        .saved-route-item {
            display: flex;
            align-items: center;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 8px;
            background: #f8f8f8;
            cursor: pointer;
        }

        .saved-route-item:active {
            background: #e8e8e8;
        }

        .saved-route-icon {
            font-size: 24px;
            margin-right: 12px;
        }

        .saved-route-info {
            flex: 1;
        }

        .saved-route-name {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
        }

        .saved-route-details {
            font-size: 13px;
            color: #666;
        }

        .saved-route-size {
            font-size: 12px;
            color: #999;
            margin-top: 2px;
        }

        .saved-route-actions {
            display: flex;
            gap: 8px;
        }

        .saved-route-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            background: #e0e0e0;
            font-size: 16px;
            cursor: pointer;
        }

        .saved-route-btn.delete {
            background: #ffebee;
        }

        .saved-route-btn:active {
            transform: scale(0.95);
        }

        /* Download Modal */
        .download-modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 300;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .download-modal.show {
            display: flex;
        }

        .download-modal-content {
            background: white;
            border-radius: 20px;
            padding: 32px;
            text-align: center;
            width: 100%;
            max-width: 320px;
        }

        .download-modal .download-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .download-modal .download-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .download-progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .download-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2196F3, #4CAF50);
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .download-modal .download-status {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
        }

        .download-cancel-btn {
            padding: 12px 32px;
            border: none;
            border-radius: 24px;
            background: #f0f0f0;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
        }

        .download-cancel-btn:active {
            background: #e0e0e0;
        }

        /* Route Selection Panel */
        .route-options {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            z-index: 150;
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            max-height: 50vh;
            overflow-y: auto;
            padding-bottom: max(16px, env(safe-area-inset-bottom));
        }

        .route-options.show {
            transform: translateY(0);
        }

        .route-options-header {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid #eee;
            position: sticky;
            top: 0;
            background: white;
            z-index: 1;
        }

        .route-options-title {
            font-size: 18px;
            font-weight: 600;
            flex: 1;
        }

        .route-options-close {
            width: 32px;
            height: 32px;
            border: none;
            background: #f0f0f0;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
        }

        .route-option {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.2s;
        }

        .route-option:hover {
            background: #f8f8f8;
        }

        .route-option.selected {
            background: #E3F2FD;
            border-left: 4px solid #2196F3;
        }

        .route-option-color {
            width: 8px;
            height: 40px;
            border-radius: 4px;
            margin-right: 16px;
        }

        .route-option-color.primary { background: #2196F3; }
        .route-option-color.alt1 { background: #9E9E9E; }
        .route-option-color.alt2 { background: #757575; }

        .route-option-info {
            flex: 1;
        }

        .route-option-label {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .route-option-time {
            font-size: 22px;
            font-weight: 700;
            color: #2196F3;
            margin: 4px 0;
        }

        .route-option-time.delayed {
            color: #FF6D00;
        }

        .route-option-time.heavy {
            color: #D50000;
        }

        .route-option-details {
            font-size: 13px;
            color: #666;
        }

        .route-option-traffic {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .route-option-traffic.free { background: #E8F5E9; color: #2E7D32; }
        .route-option-traffic.moderate { background: #FFF8E1; color: #F57F17; }
        .route-option-traffic.heavy { background: #FBE9E7; color: #E64A19; }
        .route-option-traffic.severe { background: #FFEBEE; color: #C62828; }
        .route-option-traffic.unknown { background: #ECEFF1; color: #607D8B; }

        .route-option-go {
            width: 48px;
            height: 48px;
            border: none;
            background: #2196F3;
            border-radius: 50%;
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .route-option-go:hover {
            background: #1976D2;
        }

        /* ============================================ */
        /* Dark Mode Styles */
        /* ============================================ */
        body.dark-mode {
            background: #121212;
        }

        body.dark-mode .search-box {
            background: #1e1e1e;
            box-shadow: 0 2px 12px rgba(0,0,0,0.4);
        }

        body.dark-mode .search-text {
            color: #e0e0e0;
        }

        body.dark-mode .search-text span {
            color: #888;
        }

        body.dark-mode .search-icon {
            color: #888;
        }

        body.dark-mode .menu-btn,
        body.dark-mode .fab-locate,
        body.dark-mode .fab-report,
        body.dark-mode .fab-traffic {
            background: #2a2a2a;
            color: #e0e0e0;
            box-shadow: 0 2px 12px rgba(0,0,0,0.4);
        }

        body.dark-mode .fab-traffic.active {
            background: #1b5e20;
        }

        body.dark-mode .bottom-bar {
            background: #1e1e1e;
            box-shadow: 0 -2px 20px rgba(0,0,0,0.4);
        }

        body.dark-mode .quick-action:active {
            background: #333;
        }

        body.dark-mode .quick-action-icon.home { background: #1a3a5c; }
        body.dark-mode .quick-action-icon.work { background: #4a2a3a; }
        body.dark-mode .quick-action-icon.gas { background: #4a3a1a; }
        body.dark-mode .quick-action-icon.food { background: #1a4a2a; }
        body.dark-mode .quick-action-icon.more { background: #3a2a4a; }

        body.dark-mode .quick-action-label {
            color: #aaa;
        }

        body.dark-mode .search-overlay {
            background: #121212;
        }

        body.dark-mode .search-header {
            border-bottom-color: #333;
        }

        body.dark-mode .search-input-wrapper {
            background: #2a2a2a;
        }

        body.dark-mode .search-input {
            background: transparent;
            color: #e0e0e0;
        }

        body.dark-mode .search-input::placeholder {
            color: #666;
        }

        body.dark-mode .search-back,
        body.dark-mode .search-clear {
            color: #aaa;
        }

        body.dark-mode .search-results {
            background: #121212;
        }

        body.dark-mode .search-section-title {
            color: #888;
            background: #121212;
        }

        body.dark-mode .search-result {
            border-bottom-color: #2a2a2a;
        }

        body.dark-mode .search-result:active {
            background: #2a2a2a;
        }

        body.dark-mode .search-result-name {
            color: #e0e0e0;
        }

        body.dark-mode .search-result-address {
            color: #888;
        }

        body.dark-mode .nav-panel {
            background: #1e1e1e;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.5);
        }

        body.dark-mode .nav-panel-drag {
            background: #444;
        }

        body.dark-mode .nav-destination-info h3 {
            color: #e0e0e0;
        }

        body.dark-mode .nav-destination-info p {
            color: #888;
        }

        body.dark-mode .nav-action-btn.secondary {
            background: #2a2a2a;
            color: #e0e0e0;
        }

        body.dark-mode .directions-summary {
            background: #252525;
            border-bottom-color: #333;
        }

        body.dark-mode .directions-duration {
            color: #4CAF50;
        }

        body.dark-mode .directions-distance {
            color: #aaa;
        }

        body.dark-mode .directions-step {
            border-bottom-color: #2a2a2a;
        }

        body.dark-mode .directions-step-instruction {
            color: #e0e0e0;
        }

        body.dark-mode .directions-step-distance {
            color: #888;
        }

        body.dark-mode .directions-step.current-step {
            background: #1a3a1a;
        }

        body.dark-mode .menu-panel {
            background: #1e1e1e;
        }

        body.dark-mode .menu-header {
            background: linear-gradient(135deg, #1a237e 0%, #311b92 100%);
        }

        body.dark-mode .menu-item {
            color: #e0e0e0;
        }

        body.dark-mode .menu-item:active {
            background: #2a2a2a;
        }

        body.dark-mode .menu-divider {
            background: #333;
        }

        body.dark-mode .settings-panel,
        body.dark-mode .report-panel,
        body.dark-mode .saved-routes-panel,
        body.dark-mode .layers-panel {
            background: #1e1e1e;
        }

        body.dark-mode .settings-header,
        body.dark-mode .report-header,
        body.dark-mode .saved-routes-header,
        body.dark-mode .layers-header {
            background: #1e1e1e;
            border-bottom-color: #333;
        }

        body.dark-mode .settings-title,
        body.dark-mode .report-title,
        body.dark-mode .saved-routes-title,
        body.dark-mode .layers-title {
            color: #e0e0e0;
        }

        body.dark-mode .settings-back,
        body.dark-mode .report-back,
        body.dark-mode .saved-routes-back,
        body.dark-mode .layers-back {
            color: #aaa;
        }

        body.dark-mode .layers-section-title {
            color: #888;
        }

        body.dark-mode .layer-option {
            background: #2a2a2a;
        }

        body.dark-mode .layer-option.selected {
            background: #1a3a5c;
        }

        body.dark-mode .layer-name {
            color: #e0e0e0;
        }

        body.dark-mode .layer-toggle {
            background: #2a2a2a;
        }

        body.dark-mode .layer-toggle-label {
            color: #e0e0e0;
        }

        body.dark-mode .settings-section-title {
            color: #888;
        }

        body.dark-mode .settings-item {
            border-bottom-color: #2a2a2a;
        }

        body.dark-mode .settings-item-label {
            color: #e0e0e0;
        }

        body.dark-mode .settings-item-value {
            color: #888;
        }

        body.dark-mode .report-type {
            background: #2a2a2a;
        }

        body.dark-mode .report-type.selected {
            background: #1a3a5c;
            border-color: #2196F3;
        }

        body.dark-mode .report-type-label {
            color: #e0e0e0;
        }

        body.dark-mode .report-submit {
            background: #2196F3;
        }

        body.dark-mode .report-submit:disabled {
            background: #333;
            color: #666;
        }

        body.dark-mode .incident-alert {
            background: #2a2a2a;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        body.dark-mode .incident-alert-title {
            color: #e0e0e0;
        }

        body.dark-mode .incident-alert-distance {
            color: #888;
        }

        body.dark-mode .toast {
            background: #333;
            color: #e0e0e0;
        }

        body.dark-mode .route-options {
            background: #1e1e1e;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.5);
        }

        body.dark-mode .route-options-title {
            color: #e0e0e0;
        }

        body.dark-mode .route-options-close {
            color: #888;
        }

        body.dark-mode .route-option {
            background: #252525;
        }

        body.dark-mode .route-option.selected {
            background: #1a3a1a;
            border-color: #4CAF50;
        }

        body.dark-mode .route-option-label {
            color: #e0e0e0;
        }

        body.dark-mode .route-option-duration {
            color: #4CAF50;
        }

        body.dark-mode .route-option-distance,
        body.dark-mode .route-option-traffic {
            color: #888;
        }

        body.dark-mode .traffic-legend {
            background: #2a2a2a;
            box-shadow: 0 2px 12px rgba(0,0,0,0.4);
        }

        body.dark-mode .traffic-legend-title {
            color: #e0e0e0;
        }

        body.dark-mode .traffic-legend-label {
            color: #aaa;
        }

        body.dark-mode .saved-route-item {
            background: #252525;
        }

        body.dark-mode .saved-route-item:active {
            background: #333;
        }

        body.dark-mode .saved-route-name {
            color: #e0e0e0;
        }

        body.dark-mode .saved-route-details {
            color: #aaa;
        }

        body.dark-mode .saved-route-size {
            color: #666;
        }

        body.dark-mode .saved-route-btn {
            background: #333;
        }

        body.dark-mode .saved-route-btn.delete {
            background: #4a2a2a;
        }

        body.dark-mode .saved-routes-empty .empty-text {
            color: #e0e0e0;
        }

        body.dark-mode .saved-routes-empty .empty-hint {
            color: #888;
        }

        body.dark-mode .download-modal-content {
            background: #1e1e1e;
        }

        body.dark-mode .download-title {
            color: #e0e0e0;
        }

        body.dark-mode .download-status {
            color: #888;
        }

        body.dark-mode .download-progress-bar {
            background: #333;
        }

        body.dark-mode .download-cancel-btn {
            background: #333;
            color: #e0e0e0;
        }

        body.dark-mode #nav-speed-display {
            background: #2a2a2a !important;
            box-shadow: 0 2px 12px rgba(0,0,0,0.4) !important;
        }

        body.dark-mode #nav-eta-display {
            background: #2a2a2a !important;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4) !important;
        }

        /* Dark mode maplibre controls */
        body.dark-mode .maplibregl-ctrl-group {
            background: #2a2a2a;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
        }

        body.dark-mode .maplibregl-ctrl-group button {
            background-color: #2a2a2a;
        }

        body.dark-mode .maplibregl-ctrl-group button:hover {
            background-color: #3a3a3a;
        }

        body.dark-mode .maplibregl-ctrl-group button + button {
            border-top-color: #444;
        }

        body.dark-mode .maplibregl-popup-content {
            background: #2a2a2a;
            color: #e0e0e0;
        }

        body.dark-mode .maplibregl-popup-anchor-bottom .maplibregl-popup-tip {
            border-top-color: #2a2a2a;
        }

        body.dark-mode .incident-popup {
            color: #e0e0e0;
        }

        body.dark-mode .incident-popup-time {
            color: #888;
        }

        body.dark-mode .incident-dismiss-btn {
            background: #333;
            color: #aaa;
        }

        /* ============================================ */
        /* Lane Guidance Styles */
        /* ============================================ */
        .lane-guidance {
            position: fixed;
            top: 110px;
            right: 16px;
            background: white;
            border-radius: 12px;
            padding: 12px 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 160;
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            max-width: 200px;
        }

        .lane-guidance.show {
            display: flex;
        }

        .lane-guidance-title {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .lane-guidance-arrows {
            display: flex;
            gap: 4px;
        }

        .lane-arrow {
            width: 36px;
            height: 48px;
            border-radius: 6px;
            background: #e0e0e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .lane-arrow.valid {
            background: #4CAF50;
        }

        .lane-arrow svg {
            width: 24px;
            height: 24px;
            fill: #666;
        }

        .lane-arrow.valid svg {
            fill: white;
        }

        .lane-arrow-divider {
            position: absolute;
            right: -2px;
            top: 8px;
            bottom: 8px;
            width: 2px;
            background: #ccc;
        }

        .lane-arrow:last-child .lane-arrow-divider {
            display: none;
        }

        .lane-guidance-hint {
            font-size: 11px;
            color: #888;
            text-align: center;
        }

        /* Dark mode lane guidance */
        body.dark-mode .lane-guidance {
            background: #2a2a2a;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }

        body.dark-mode .lane-guidance-title {
            color: #aaa;
        }

        body.dark-mode .lane-arrow {
            background: #444;
        }

        body.dark-mode .lane-arrow.valid {
            background: #2E7D32;
        }

        body.dark-mode .lane-arrow svg {
            fill: #888;
        }

        body.dark-mode .lane-arrow.valid svg {
            fill: white;
        }

        body.dark-mode .lane-arrow-divider {
            background: #555;
        }

        body.dark-mode .lane-guidance-hint {
            color: #666;
        }

        /* ============================================ */
        /* Share ETA Modal Styles */
        /* ============================================ */
        .share-eta-modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 300;
            display: none;
            align-items: flex-end;
            justify-content: center;
        }

        .share-eta-modal.show {
            display: flex;
        }

        .share-eta-content {
            background: white;
            border-radius: 20px 20px 0 0;
            width: 100%;
            max-width: 500px;
            padding: 20px;
            padding-bottom: max(20px, env(safe-area-inset-bottom));
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .share-eta-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .share-eta-title {
            font-size: 20px;
            font-weight: 600;
        }

        .share-eta-close {
            width: 36px;
            height: 36px;
            border: none;
            background: #f0f0f0;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .share-eta-preview {
            background: #f8f8f8;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .share-eta-destination {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 8px;
        }

        .share-eta-info {
            display: flex;
            gap: 16px;
            font-size: 14px;
            color: #666;
        }

        .share-eta-info span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .share-eta-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .share-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 16px 8px;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 12px;
        }

        .share-option:active {
            background: #f0f0f0;
        }

        .share-option-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .share-option-icon.sms { background: #4CAF50; }
        .share-option-icon.whatsapp { background: #25D366; }
        .share-option-icon.email { background: #EA4335; }
        .share-option-icon.copy { background: #2196F3; }

        .share-option-label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }

        .share-eta-link {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .share-eta-link input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 12px;
            font-size: 14px;
            background: #f8f8f8;
        }

        .share-eta-link button {
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            background: #2196F3;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }

        .share-eta-note {
            font-size: 12px;
            color: #888;
            text-align: center;
        }

        .share-eta-live {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 12px;
            padding: 12px;
            background: #E8F5E9;
            border-radius: 12px;
        }

        .share-eta-live-dot {
            width: 8px;
            height: 8px;
            background: #4CAF50;
            border-radius: 50%;
            animation: pulse-dot 1.5s infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        .share-eta-live-text {
            font-size: 13px;
            color: #2E7D32;
            font-weight: 500;
        }

        /* Share ETA FAB during navigation */
        .fab-share-eta {
            position: fixed;
            left: 16px;
            bottom: 270px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #2196F3;
            color: white;
            border: none;
            box-shadow: 0 2px 12px rgba(33, 150, 243, 0.4);
            font-size: 20px;
            cursor: pointer;
            z-index: 90;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .fab-share-eta.show {
            display: flex;
        }

        .fab-share-eta:active {
            transform: scale(0.95);
        }

        /* Dark mode share ETA */
        body.dark-mode .share-eta-content {
            background: #1e1e1e;
        }

        body.dark-mode .share-eta-title {
            color: #e0e0e0;
        }

        body.dark-mode .share-eta-close {
            background: #333;
            color: #aaa;
        }

        body.dark-mode .share-eta-preview {
            background: #252525;
        }

        body.dark-mode .share-eta-destination {
            color: #e0e0e0;
        }

        body.dark-mode .share-eta-info {
            color: #888;
        }

        body.dark-mode .share-option:active {
            background: #333;
        }

        body.dark-mode .share-option-label {
            color: #aaa;
        }

        body.dark-mode .share-eta-link input {
            background: #252525;
            border-color: #444;
            color: #e0e0e0;
        }

        body.dark-mode .share-eta-note {
            color: #666;
        }

        body.dark-mode .share-eta-live {
            background: #1a3a1a;
        }

        body.dark-mode .share-eta-live-text {
            color: #81C784;
        }
    </style>
    <link rel="preload" href="css/maps.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="css/maps.css"></noscript>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading map...</div>
    </div>

    <!-- Map Container -->
    <div id="map"></div>

    <!-- Search Pill (Waze-style) -->
    <div class="search-pill">
        <div class="search-box" id="search-trigger" onclick="openSearch()">
            <span class="search-icon"></span>
            <div class="search-text">
                <span>Where to?</span>
            </div>
        </div>
        <button class="menu-btn" id="menu-btn" onclick="toggleMenu()">
            
        </button>
    </div>

    <!-- Locate Me FAB -->
    <button class="fab-locate" id="fab-locate" onclick="locateMe()">
        
    </button>

    <!-- Report Incident FAB -->
    <button class="fab-report" id="fab-report" onclick="openReportPanel()">
        
    </button>

    <!-- Incident Alert Toast -->
    <div class="incident-alert" id="incident-alert">
        <div class="incident-alert-icon" id="incident-alert-icon"></div>
        <div class="incident-alert-content">
            <div class="incident-alert-title" id="incident-alert-title">Police reported ahead</div>
            <div class="incident-alert-distance" id="incident-alert-distance">500m ahead</div>
        </div>
        <button class="incident-alert-close" onclick="closeIncidentAlert()"></button>
    </div>

    <!-- Camera Alert Toast -->
    <div class="camera-alert" id="camera-alert">
        <div class="camera-alert-icon" id="camera-alert-icon"></div>
        <div class="camera-alert-content">
            <div class="camera-alert-title" id="camera-alert-title">Speed Camera Ahead</div>
            <div class="camera-alert-speed" id="camera-alert-speed">60 km/h</div>
            <div class="camera-alert-distance" id="camera-alert-distance">500m ahead</div>
        </div>
        <button class="camera-alert-close" onclick="closeCameraAlert()"></button>
    </div>

    <!-- Lane Guidance Panel -->
    <div class="lane-guidance" id="lane-guidance">
        <div class="lane-guidance-title">Use lanes</div>
        <div class="lane-guidance-arrows" id="lane-guidance-arrows">
            <!-- Lane arrows will be dynamically inserted -->
        </div>
        <div class="lane-guidance-hint" id="lane-guidance-hint">Stay in highlighted lane</div>
    </div>

    <!-- Share ETA FAB (shown during navigation) -->
    <button class="fab-share-eta" id="fab-share-eta" onclick="openShareETA()">
        
    </button>

    <!-- Share ETA Modal -->
    <div class="share-eta-modal" id="share-eta-modal" onclick="closeShareETAOnBackdrop(event)">
        <div class="share-eta-content" onclick="event.stopPropagation()">
            <div class="share-eta-header">
                <div class="share-eta-title">Share your ETA</div>
                <button class="share-eta-close" onclick="closeShareETA()"></button>
            </div>

            <div class="share-eta-live">
                <div class="share-eta-live-dot"></div>
                <div class="share-eta-live-text">Live location sharing</div>
            </div>

            <div class="share-eta-preview">
                <div class="share-eta-destination" id="share-eta-destination">Destination</div>
                <div class="share-eta-info">
                    <span> <span id="share-eta-time">--</span></span>
                    <span> <span id="share-eta-distance">--</span></span>
                    <span> <span id="share-eta-arrival">--</span></span>
                </div>
            </div>

            <div class="share-eta-options">
                <button class="share-option" onclick="shareETAvia('sms')">
                    <div class="share-option-icon sms"></div>
                    <div class="share-option-label">SMS</div>
                </button>
                <button class="share-option" onclick="shareETAvia('whatsapp')">
                    <div class="share-option-icon whatsapp"></div>
                    <div class="share-option-label">WhatsApp</div>
                </button>
                <button class="share-option" onclick="shareETAvia('email')">
                    <div class="share-option-icon email"></div>
                    <div class="share-option-label">Email</div>
                </button>
                <button class="share-option" onclick="shareETAvia('copy')">
                    <div class="share-option-icon copy"></div>
                    <div class="share-option-label">Copy</div>
                </button>
            </div>

            <div class="share-eta-link">
                <input type="text" id="share-eta-link-input" readonly placeholder="Generating link...">
                <button onclick="copyShareLink()">Copy</button>
            </div>

            <div class="share-eta-note">
                Your live location will be shared until you arrive or stop navigation
            </div>
        </div>
    </div>

    <!-- Traffic FAB -->
    <button class="fab-traffic" id="fab-traffic" onclick="quickToggleTraffic()">
        
    </button>

    <!-- Traffic Legend -->
    <div class="traffic-legend" id="traffic-legend">
        <div class="traffic-legend-title">Traffic</div>
        <div class="traffic-legend-item">
            <div class="traffic-legend-color free"></div>
            <span class="traffic-legend-label">Free flow</span>
        </div>
        <div class="traffic-legend-item">
            <div class="traffic-legend-color moderate"></div>
            <span class="traffic-legend-label">Moderate</span>
        </div>
        <div class="traffic-legend-item">
            <div class="traffic-legend-color heavy"></div>
            <span class="traffic-legend-label">Heavy</span>
        </div>
        <div class="traffic-legend-item">
            <div class="traffic-legend-color severe"></div>
            <span class="traffic-legend-label">Severe</span>
        </div>
    </div>

    <!-- Route Options Panel -->
    <div class="route-options" id="route-options">
        <div class="route-options-header">
            <div class="route-options-title">Choose a route</div>
            <button class="route-options-close" onclick="closeRouteOptions()"></button>
        </div>
        <div id="route-options-list">
            <!-- Route options will be dynamically inserted here -->
        </div>
    </div>

    <!-- Bottom Action Bar -->
    <div class="bottom-bar" id="bottom-bar">
        <div class="quick-actions">
            <button class="quick-action" onclick="goToSaved('home')">
                <div class="quick-action-icon home"></div>
                <span class="quick-action-label">Home</span>
            </button>
            <button class="quick-action" onclick="goToSaved('work')">
                <div class="quick-action-icon work"></div>
                <span class="quick-action-label">Work</span>
            </button>
            <button class="quick-action" onclick="searchNearby('gas_station')">
                <div class="quick-action-icon gas"></div>
                <span class="quick-action-label">Gas</span>
            </button>
            <button class="quick-action" onclick="searchNearby('restaurant')">
                <div class="quick-action-icon food"></div>
                <span class="quick-action-label">Food</span>
            </button>
            <button class="quick-action" onclick="openSearch()">
                <div class="quick-action-icon more"></div>
                <span class="quick-action-label">More</span>
            </button>
        </div>
    </div>

    <!-- Search Backdrop (dims the map) -->
    <div class="search-backdrop" id="search-backdrop" onclick="closeSearch()"></div>

    <!-- Search Bottom Sheet (Waze-style) -->
    <div class="search-overlay" id="search-overlay">
        <div class="search-drag-handle"></div>
        <div class="search-header">
            <button class="search-back" onclick="closeSearch()"></button>
            <div class="search-input-wrapper">
                <input type="text" id="search-input" placeholder="Where to?" autocomplete="off">
                <button class="search-clear" id="search-clear" onclick="clearSearch()"></button>
            </div>
        </div>
        <div class="search-body">
            <!-- Default content (saved places, categories) -->
            <div id="search-default">
                <div class="search-section">
                    <div class="search-section-title">Saved Places</div>
                    <div class="saved-places">
                        <button class="saved-place" onclick="goToSaved('home')">
                            <span class="saved-place-icon"></span>
                            <span class="saved-place-label">Home</span>
                            <span class="saved-place-address" id="home-address">Set location</span>
                        </button>
                        <button class="saved-place" onclick="goToSaved('work')">
                            <span class="saved-place-icon"></span>
                            <span class="saved-place-label">Work</span>
                            <span class="saved-place-address" id="work-address">Set location</span>
                        </button>
                    </div>
                </div>
                <div class="search-section">
                    <div class="search-section-title">Categories</div>
                    <div class="category-chips">
                        <button class="category-chip" onclick="searchNearby('gas_station')"> Gas stations</button>
                        <button class="category-chip" onclick="searchNearby('restaurant')"> Restaurants</button>
                        <button class="category-chip" onclick="searchNearby('cafe')"> Coffee</button>
                        <button class="category-chip" onclick="searchNearby('atm')"> ATMs</button>
                        <button class="category-chip" onclick="searchNearby('parking')"> Parking</button>
                        <button class="category-chip" onclick="searchNearby('hospital')"> Hospitals</button>
                        <button class="category-chip" onclick="searchNearby('pharmacy')"> Pharmacies</button>
                        <button class="category-chip" onclick="searchNearby('supermarket')"> Grocery</button>
                    </div>
                </div>
                <div class="search-section" id="recent-section" style="display:none;">
                    <div class="search-section-title">Recent</div>
                    <div id="recent-searches"></div>
                </div>
            </div>

            <!-- Search results -->
            <div class="search-results" id="search-results"></div>
        </div>
    </div>

    <!-- Navigation Panel (slides up when destination selected) -->
    <div class="nav-panel" id="nav-panel">
        <div class="nav-panel-header">
            <div class="nav-panel-drag"></div>
            <div class="nav-destination">
                <div class="nav-destination-icon" id="nav-icon"></div>
                <div class="nav-destination-info">
                    <h3 id="nav-name">Destination</h3>
                    <p id="nav-address">Address</p>
                </div>
            </div>
        </div>
        <div class="nav-panel-actions" id="nav-actions-initial">
            <button class="nav-action-btn primary" onclick="startNavigation()">
                 Directions
            </button>
            <button class="nav-action-btn secondary" onclick="closeNavPanel()">
                 Cancel
            </button>
        </div>

        <!-- Directions List (shown after getting directions) -->
        <div class="directions-list" id="directions-list">
            <div class="directions-summary">
                <div class="directions-summary-info">
                    <div class="directions-time" id="directions-time">32 min</div>
                    <div class="directions-distance" id="directions-distance">26.2 km</div>
                </div>
            </div>
            <div id="directions-steps">
                <!-- Steps populated by JavaScript -->
            </div>
        </div>

        <div class="nav-panel-actions" id="nav-actions-route" style="display:none;">
            <button class="nav-action-btn primary" onclick="startLiveNavigation()">
                 Start
            </button>
            <button class="nav-action-btn secondary" onclick="saveRouteOffline()">
                 Save
            </button>
            <button class="nav-action-btn secondary" onclick="closeNavPanel()">
                 Cancel
            </button>
        </div>
    </div>

    <!-- Menu Panel -->
    <div class="menu-overlay" id="menu-overlay" onclick="toggleMenu()"></div>
    <div class="menu-panel" id="menu-panel">
        <div class="menu-header">
            <h2>Data Acuity Maps</h2>
            <p>Navigate anywhere</p>
        </div>
        <div class="menu-items">
            <button class="menu-item" onclick="startOver()">
                <span class="menu-item-icon"></span>
                Start Over
            </button>
            <div class="menu-divider"></div>
            <button class="menu-item" onclick="openSearch()">
                <span class="menu-item-icon"></span>
                Search
            </button>
            <button class="menu-item" onclick="locateMe(); toggleMenu();">
                <span class="menu-item-icon"></span>
                My Location
            </button>
            <div class="menu-divider"></div>
            <button class="menu-item" onclick="setSavedPlace('home')">
                <span class="menu-item-icon"></span>
                Set Home
            </button>
            <button class="menu-item" onclick="setSavedPlace('work')">
                <span class="menu-item-icon"></span>
                Set Work
            </button>
            <button class="menu-item" onclick="openSavedRoutes()">
                <span class="menu-item-icon"></span>
                Saved Routes
            </button>
            <button class="menu-item" onclick="openRegionDownload()">
                <span class="menu-item-icon"></span>
                Offline Maps
            </button>
            <button class="menu-item" onclick="openFuelPrices()">
                <span class="menu-item-icon"></span>
                Fuel Prices
            </button>
            <div class="menu-divider"></div>
            <button class="menu-item" onclick="openTimeline()">
                <span class="menu-item-icon"></span>
                Historical Timeline
            </button>
            <button class="menu-item" onclick="openTransit()">
                <span class="menu-item-icon"></span>
                Public Transit
            </button>
            <div class="menu-divider"></div>
            <button class="menu-item" onclick="openLayers()">
                <span class="menu-item-icon"></span>
                Map Style
            </button>
            <button class="menu-item" onclick="openSettings()">
                <span class="menu-item-icon"></span>
                Settings
            </button>
            <button class="menu-item" onclick="openAbout()">
                <span class="menu-item-icon"></span>
                About
            </button>
        </div>
    </div>

    <!-- Saved Routes Panel -->
    <div class="search-backdrop" id="saved-routes-backdrop" onclick="closeSavedRoutes()"></div>
    <div class="saved-routes-panel" id="saved-routes-panel">
        <div class="saved-routes-header">
            <button class="saved-routes-back" onclick="closeSavedRoutes()"></button>
            <div class="saved-routes-title">Saved Routes</div>
        </div>
        <div class="saved-routes-body" id="saved-routes-list">
            <!-- Populated by JavaScript -->
        </div>
        <div class="saved-routes-empty" id="saved-routes-empty">
            <div class="empty-icon"></div>
            <div class="empty-text">No saved routes yet</div>
            <div class="empty-hint">Save a route to use it offline</div>
        </div>
    </div>

    <!-- Download Progress Modal -->
    <div class="download-modal" id="download-modal">
        <div class="download-modal-content">
            <div class="download-icon"></div>
            <div class="download-title" id="download-title">Saving Route</div>
            <div class="download-progress-bar">
                <div class="download-progress-fill" id="download-progress-fill"></div>
            </div>
            <div class="download-status" id="download-status">Downloading tiles...</div>
            <button class="download-cancel-btn" id="download-cancel-btn" onclick="cancelDownload()">Cancel</button>
        </div>
    </div>

    <!-- Report Incident Panel -->
    <div class="search-backdrop" id="report-backdrop" onclick="closeReportPanel()"></div>
    <div class="report-panel" id="report-panel">
        <div class="report-header">
            <button class="report-back" onclick="closeReportPanel()"></button>
            <div class="report-title">Report Incident</div>
        </div>
        <div class="report-body">
            <div class="report-grid">
                <button class="report-type" data-type="police" onclick="selectIncidentType(this)">
                    <div class="report-type-icon"></div>
                    <div class="report-type-label">Police</div>
                </button>
                <button class="report-type" data-type="accident" onclick="selectIncidentType(this)">
                    <div class="report-type-icon"></div>
                    <div class="report-type-label">Accident</div>
                </button>
                <button class="report-type" data-type="hazard" onclick="selectIncidentType(this)">
                    <div class="report-type-icon"></div>
                    <div class="report-type-label">Hazard</div>
                </button>
                <button class="report-type" data-type="traffic" onclick="selectIncidentType(this)">
                    <div class="report-type-icon"></div>
                    <div class="report-type-label">Traffic Jam</div>
                </button>
                <button class="report-type" data-type="closure" onclick="selectIncidentType(this)">
                    <div class="report-type-icon"></div>
                    <div class="report-type-label">Road Closed</div>
                </button>
                <button class="report-type" data-type="construction" onclick="selectIncidentType(this)">
                    <div class="report-type-icon"></div>
                    <div class="report-type-label">Construction</div>
                </button>
                <button class="report-type" data-type="speed_camera" onclick="selectIncidentType(this)">
                    <div class="report-type-icon"></div>
                    <div class="report-type-label">Speed Camera</div>
                </button>
                <button class="report-type" data-type="red_light" onclick="selectIncidentType(this)">
                    <div class="report-type-icon"></div>
                    <div class="report-type-label">Red Light Cam</div>
                </button>
            </div>
            <button class="report-submit" id="report-submit" onclick="submitIncident()" disabled>
                Report at Current Location
            </button>
        </div>
    </div>

    <!-- Layers Backdrop -->
    <div class="search-backdrop" id="layers-backdrop" onclick="closeLayersPanel()"></div>

    <!-- Map Layers Panel -->
    <div class="layers-panel" id="layers-panel">
        <div class="layers-header">
            <button class="layers-back" onclick="closeLayersPanel()"></button>
            <div class="layers-title">Map Type</div>
        </div>
        <div class="layers-body">
            <!-- Map Types Section -->
            <div class="layers-section">
                <div class="layers-section-title">Map Style</div>
                <div class="layers-grid">
                    <div class="layer-option selected" data-style="streets" onclick="selectMapStyle(this)">
                        <div class="layer-preview streets"></div>
                        <div class="layer-name">Streets</div>
                    </div>
                    <div class="layer-option" data-style="satellite" onclick="selectMapStyle(this)">
                        <div class="layer-preview satellite"></div>
                        <div class="layer-name">Satellite</div>
                    </div>
                    <div class="layer-option" data-style="dark" onclick="selectMapStyle(this)">
                        <div class="layer-preview dark"></div>
                        <div class="layer-name">Dark</div>
                    </div>
                    <div class="layer-option" data-style="local" onclick="selectMapStyle(this)">
                        <div class="layer-preview local"></div>
                        <div class="layer-name">SA Local</div>
                        <div class="layer-badge">Offline</div>
                    </div>
                    <div class="layer-option" data-style="terrain" onclick="selectMapStyle(this)">
                        <div class="layer-preview terrain"></div>
                        <div class="layer-name">Terrain</div>
                    </div>
                    <div class="layer-option" data-style="hybrid" onclick="selectMapStyle(this)">
                        <div class="layer-preview hybrid"></div>
                        <div class="layer-name">Hybrid</div>
                    </div>
                </div>
            </div>

            <!-- Map Details Section -->
            <div class="layers-section">
                <div class="layers-section-title">Map Details</div>
                <div class="layers-toggles">
                    <label class="layer-toggle">
                        <div class="layer-toggle-icon"></div>
                        <div class="layer-toggle-content">
                            <div class="layer-toggle-label">Traffic</div>
                            <div class="layer-toggle-desc">Show real-time traffic</div>
                        </div>
                        <input type="checkbox" id="layer-traffic" onchange="toggleLayerOption('traffic', this.checked)">
                    </label>
                    <label class="layer-toggle">
                        <div class="layer-toggle-icon"></div>
                        <div class="layer-toggle-content">
                            <div class="layer-toggle-label">Transit</div>
                            <div class="layer-toggle-desc">Show bus & taxi stops</div>
                        </div>
                        <input type="checkbox" id="layer-transit" onchange="toggleLayerOption('transit', this.checked)">
                    </label>
                    <label class="layer-toggle">
                        <div class="layer-toggle-icon"></div>
                        <div class="layer-toggle-content">
                            <div class="layer-toggle-label">Cycling</div>
                            <div class="layer-toggle-desc">Show bike lanes & paths</div>
                        </div>
                        <input type="checkbox" id="layer-cycling" onchange="toggleLayerOption('cycling', this.checked)">
                    </label>
                    <label class="layer-toggle">
                        <div class="layer-toggle-icon"></div>
                        <div class="layer-toggle-content">
                            <div class="layer-toggle-label">3D Buildings</div>
                            <div class="layer-toggle-desc">Show building extrusions</div>
                        </div>
                        <input type="checkbox" id="layer-3d" onchange="toggleLayerOption('3d', this.checked)">
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Timeline Backdrop -->
    <div class="search-backdrop" id="timeline-backdrop" onclick="closeTimelinePanel()"></div>

    <!-- Historical Timeline Panel -->
    <div class="timeline-panel" id="timeline-panel">
        <div class="timeline-header">
            <button class="timeline-back" onclick="closeTimelinePanel()"></button>
            <div class="timeline-title">Historical Maps</div>
        </div>
        <div class="timeline-body">
            <!-- Year Slider -->
            <div class="timeline-slider-container">
                <div class="timeline-year-display">
                    <span class="timeline-year" id="timeline-year-value">1500</span>
                    <span class="timeline-year-suffix" id="timeline-year-suffix">CE</span>
                    <div class="timeline-period" id="timeline-period-name">Age of Exploration</div>
                </div>
                <input type="range" class="timeline-slider" id="timeline-slider"
                       min="-3000" max="1900" value="1500" step="50"
                       oninput="updateTimelineYear(this.value)">
                <div class="timeline-labels">
                    <span>3000 BCE</span>
                    <span>0</span>
                    <span>1900 CE</span>
                </div>
            </div>

            <!-- Available Maps for Period -->
            <div class="timeline-maps-section">
                <div class="timeline-section-title">Maps from this Period</div>
                <div class="timeline-maps-grid" id="timeline-maps-grid">
                    <!-- Maps populated dynamically -->
                </div>
            </div>

            <!-- Overlay Controls -->
            <div class="timeline-overlay-controls" id="timeline-overlay-controls" style="display: none;">
                <div class="timeline-control-row">
                    <span class="timeline-control-label">Opacity</span>
                    <input type="range" class="timeline-opacity-slider" id="timeline-opacity"
                           min="0" max="100" value="70"
                           oninput="updateTimelineOpacity(this.value)">
                    <span class="timeline-opacity-value" id="timeline-opacity-value">70%</span>
                </div>
                <div class="timeline-actions">
                    <button class="timeline-action-btn timeline-clear-btn" onclick="clearTimelineOverlay()">
                        Clear Overlay
                    </button>
                    <button class="timeline-action-btn timeline-apply-btn" onclick="closeTimelinePanel()">
                        Done
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Timeline Indicator (shown when overlay is active) -->
    <div class="timeline-indicator" id="timeline-indicator">
        <span>Viewing:</span>
        <span class="timeline-indicator-year" id="timeline-indicator-title">Roman Empire</span>
        <button class="timeline-indicator-close" onclick="clearTimelineOverlay()"></button>
    </div>

    <!-- Photo Viewer Modal -->
    <div class="photo-viewer-modal" id="photo-viewer-modal" onclick="closePhotoViewer()">
        <button class="photo-viewer-close" onclick="closePhotoViewer()"></button>
        <img class="photo-viewer-img" id="photo-viewer-img" src="" alt="Photo">
    </div>

    <!-- Rideshare Backdrop -->
    <div class="search-backdrop" id="rideshare-backdrop" onclick="closeRidesharePanel()"></div>

    <!-- Rideshare Panel -->
    <div class="rideshare-panel" id="rideshare-panel">
        <div class="rideshare-header">
            <button class="rideshare-back" onclick="closeRidesharePanel()"></button>
            <div class="rideshare-title">Get a Ride</div>
        </div>
        <div class="rideshare-body">
            <div class="rideshare-destination">
                <div class="rideshare-dest-label">Going to</div>
                <div class="rideshare-dest-name" id="rideshare-dest-name">Select a destination</div>
            </div>

            <div class="rideshare-options" id="rideshare-options">
                <div class="rideshare-option" onclick="selectRideshare('uber', this)">
                    <div class="rideshare-logo uber">U</div>
                    <div class="rideshare-info">
                        <div class="rideshare-name">Uber</div>
                        <div class="rideshare-eta">~5 min away</div>
                    </div>
                    <div class="rideshare-price">
                        <div class="rideshare-price-value">R85-120</div>
                        <div class="rideshare-price-range">estimate</div>
                    </div>
                </div>
                <div class="rideshare-option" onclick="selectRideshare('bolt', this)">
                    <div class="rideshare-logo bolt">B</div>
                    <div class="rideshare-info">
                        <div class="rideshare-name">Bolt</div>
                        <div class="rideshare-eta">~4 min away</div>
                    </div>
                    <div class="rideshare-price">
                        <div class="rideshare-price-value">R75-110</div>
                        <div class="rideshare-price-range">estimate</div>
                    </div>
                </div>
                <div class="rideshare-option" onclick="selectRideshare('indrive', this)">
                    <div class="rideshare-logo indrive">i</div>
                    <div class="rideshare-info">
                        <div class="rideshare-name">inDrive</div>
                        <div class="rideshare-eta">~7 min away</div>
                    </div>
                    <div class="rideshare-price">
                        <div class="rideshare-price-value">R60-100</div>
                        <div class="rideshare-price-range">negotiate</div>
                    </div>
                </div>
                <div class="rideshare-option" onclick="selectRideshare('taxi', this)">
                    <div class="rideshare-logo taxi"></div>
                    <div class="rideshare-info">
                        <div class="rideshare-name">Metered Taxi</div>
                        <div class="rideshare-eta">Call to book</div>
                    </div>
                    <div class="rideshare-price">
                        <div class="rideshare-price-value">R100+</div>
                        <div class="rideshare-price-range">metered</div>
                    </div>
                </div>
            </div>

            <div class="rideshare-cta">
                <button class="rideshare-book-btn" id="rideshare-book-btn" onclick="bookRideshare()">
                    Open App to Book
                </button>
            </div>

            <p class="rideshare-note">
                Prices are estimates. Open the app for exact pricing.
            </p>
        </div>
    </div>

    <!-- Hidden file input for photo upload -->
    <input type="file" id="poi-photo-input" accept="image/*" capture="environment" style="display: none;" onchange="handlePoiPhotoUpload(event)">

    <!-- Fuel Prices Backdrop -->
    <div class="search-backdrop" id="fuel-backdrop" onclick="closeFuelPanel()"></div>

    <!-- Fuel Prices Panel -->
    <div class="fuel-panel" id="fuel-panel">
        <div class="fuel-header">
            <button class="fuel-back" onclick="closeFuelPanel()"></button>
            <div class="fuel-title">Fuel Prices</div>
        </div>
        <div class="fuel-body">
            <!-- Fuel Type Tabs -->
            <div class="fuel-type-tabs">
                <button class="fuel-type-tab active" data-fuel="95" onclick="switchFuelType('95')">Petrol 95</button>
                <button class="fuel-type-tab" data-fuel="93" onclick="switchFuelType('93')">Petrol 93</button>
                <button class="fuel-type-tab" data-fuel="diesel" onclick="switchFuelType('diesel')">Diesel</button>
                <button class="fuel-type-tab" data-fuel="diesel50" onclick="switchFuelType('diesel50')">Diesel 50ppm</button>
            </div>

            <!-- Station List -->
            <div id="fuel-station-list" class="fuel-station-list">
                <div class="fuel-empty">
                    <div class="fuel-empty-icon"></div>
                    <p>Enable location to find fuel stations</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Fuel Price Report Modal -->
    <div class="fuel-report-modal" id="fuel-report-modal">
        <div class="fuel-report-content">
            <div class="fuel-report-title">Report Fuel Price</div>
            <input type="hidden" id="fuel-report-station-id">
            <div class="fuel-report-input-group">
                <label class="fuel-report-label">Station</label>
                <div id="fuel-report-station-name" style="font-weight: 600; color: #333;">-</div>
            </div>
            <div class="fuel-report-input-group">
                <label class="fuel-report-label" for="fuel-report-price-95">Petrol 95 (R/L)</label>
                <input type="number" step="0.01" class="fuel-report-input" id="fuel-report-price-95" placeholder="24.50">
            </div>
            <div class="fuel-report-input-group">
                <label class="fuel-report-label" for="fuel-report-price-93">Petrol 93 (R/L)</label>
                <input type="number" step="0.01" class="fuel-report-input" id="fuel-report-price-93" placeholder="24.20">
            </div>
            <div class="fuel-report-input-group">
                <label class="fuel-report-label" for="fuel-report-price-diesel">Diesel (R/L)</label>
                <input type="number" step="0.01" class="fuel-report-input" id="fuel-report-price-diesel" placeholder="22.80">
            </div>
            <div class="fuel-report-actions">
                <button class="fuel-report-cancel" onclick="closeFuelReport()">Cancel</button>
                <button class="fuel-report-submit" onclick="submitFuelReport()">Submit</button>
            </div>
        </div>
    </div>

    <!-- Region Download Backdrop -->
    <div class="search-backdrop" id="region-backdrop" onclick="closeRegionPanel()"></div>

    <!-- Region Download Panel -->
    <div class="region-panel" id="region-panel">
        <div class="region-header">
            <button class="region-back" onclick="closeRegionPanel()"></button>
            <div class="region-title">Download Region</div>
        </div>
        <div class="region-body">
            <div class="region-info-box">
                <div class="region-info-title">Offline Maps</div>
                <div class="region-info-text">
                    Download map tiles for offline use. Choose a preset region or draw a custom area on the map.
                </div>
            </div>

            <!-- Preset Regions -->
            <div class="region-presets">
                <div class="region-preset" onclick="selectRegionPreset('current', this)" data-region="current">
                    <div class="region-preset-icon"></div>
                    <div class="region-preset-name">Current View</div>
                    <div class="region-preset-size" id="current-region-size">~10 MB</div>
                </div>
                <div class="region-preset" onclick="selectRegionPreset('city', this)" data-region="city">
                    <div class="region-preset-icon"></div>
                    <div class="region-preset-name">Nearby City</div>
                    <div class="region-preset-size">~50 MB</div>
                </div>
                <div class="region-preset" onclick="selectRegionPreset('province', this)" data-region="province">
                    <div class="region-preset-icon"></div>
                    <div class="region-preset-name">Province</div>
                    <div class="region-preset-size">~200 MB</div>
                </div>
                <div class="region-preset" onclick="selectRegionPreset('custom', this)" data-region="custom">
                    <div class="region-preset-icon"></div>
                    <div class="region-preset-name">Custom Area</div>
                    <div class="region-preset-size">Draw on map</div>
                </div>
            </div>

            <!-- Draw Button (for custom) -->
            <button class="region-draw-btn" id="region-draw-btn" style="display: none;" onclick="startRegionDraw()">
                <span></span>
                <span>Draw Area on Map</span>
            </button>

            <!-- Download Info -->
            <div class="region-download-info" id="region-download-info">
                <div class="region-stat-row">
                    <span class="region-stat-label">Area</span>
                    <span class="region-stat-value" id="region-area">-</span>
                </div>
                <div class="region-stat-row">
                    <span class="region-stat-label">Tiles to download</span>
                    <span class="region-stat-value" id="region-tiles">-</span>
                </div>
                <div class="region-stat-row">
                    <span class="region-stat-label">Estimated size</span>
                    <span class="region-stat-value" id="region-size">-</span>
                </div>
            </div>

            <!-- Download Button -->
            <button class="region-download-btn" id="region-download-btn" onclick="downloadRegion()">
                Download for Offline Use
            </button>
        </div>
    </div>

    <!-- Region Draw Mode Indicator -->
    <div class="region-draw-mode" id="region-draw-mode">
        <span>Drag to select area</span>
        <button class="region-draw-cancel" onclick="cancelRegionDraw()">Cancel</button>
    </div>

    <!-- Transit Backdrop -->
    <div class="search-backdrop" id="transit-backdrop" onclick="closeTransitPanel()"></div>

    <!-- Transit Panel -->
    <div class="transit-panel" id="transit-panel">
        <div class="transit-header">
            <button class="transit-back" onclick="closeTransitPanel()"></button>
            <div class="transit-title">Public Transport</div>
        </div>
        <div class="transit-body">
            <!-- Search Box -->
            <div class="transit-search-box">
                <input type="text" class="transit-search-input" id="transit-search"
                       placeholder="Where do you want to go?"
                       onkeyup="handleTransitSearch(event)">
            </div>

            <!-- Departure Time Selection -->
            <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                <button class="transit-tab active" id="transit-depart-now" onclick="setTransitDeparture('now')">Leave Now</button>
                <button class="transit-tab" id="transit-depart-later" onclick="setTransitDeparture('later')">Depart At</button>
                <input type="time" id="transit-depart-time" style="display: none; padding: 8px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;" onchange="updateTransitDeparture()">
            </div>

            <!-- Tabs -->
            <div class="transit-tabs">
                <button class="transit-tab active" data-tab="nearby" onclick="switchTransitTab('nearby')">Nearby</button>
                <button class="transit-tab" data-tab="routes" onclick="switchTransitTab('routes')">Plan Trip</button>
                <button class="transit-tab" data-tab="buses" onclick="switchTransitTab('buses')">Buses</button>
                <button class="transit-tab" data-tab="trains" onclick="switchTransitTab('trains')">Trains</button>
                <button class="transit-tab" data-tab="taxis" onclick="switchTransitTab('taxis')">Taxis</button>
            </div>

            <!-- Content Area -->
            <div id="transit-content">
                <!-- Populated dynamically -->
                <div class="transit-loading">
                    Enable location to see nearby transit stops...
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Backdrop -->
    <div class="settings-backdrop" id="settings-backdrop" onclick="closeSettings()"></div>

    <!-- Settings Panel (Waze-style) -->
    <div class="settings-panel" id="settings-panel">
        <div class="settings-header">
            <button class="settings-back" onclick="closeSettings()"></button>
            <div class="settings-title">Settings</div>
        </div>
        <div class="settings-body">
            <!-- General Section -->
            <div class="settings-section">
                <div class="settings-section-title">General</div>
                <div class="settings-item" onclick="toggleDistanceUnit()">
                    <div class="settings-item-icon"></div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Distance Units</div>
                        <div class="settings-item-value" id="distance-unit-value">Kilometers</div>
                    </div>
                    <div class="settings-item-arrow"></div>
                </div>
                <div class="settings-item" onclick="toggleTimeFormat()">
                    <div class="settings-item-icon"></div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Time Format</div>
                        <div class="settings-item-value" id="time-format-value">24-hour</div>
                    </div>
                    <div class="settings-item-arrow"></div>
                </div>
            </div>

            <!-- Navigation Section -->
            <div class="settings-section">
                <div class="settings-section-title">Navigation</div>
                <div class="settings-item">
                    <div class="settings-item-icon"></div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Avoid Toll Roads</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="avoid-tolls" onchange="saveSetting('avoidTolls', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-item">
                    <div class="settings-item-icon"></div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Avoid Highways</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="avoid-highways" onchange="saveSetting('avoidHighways', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-item">
                    <div class="settings-item-icon"></div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Avoid Ferries</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="avoid-ferries" onchange="saveSetting('avoidFerries', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-item">
                    <div class="settings-item-icon"></div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Avoid Unpaved Roads</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="avoid-unpaved" onchange="saveSetting('avoidUnpaved', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <!-- Map Display Section -->
            <div class="settings-section">
                <div class="settings-section-title">Map Display</div>
                <div class="settings-item">
                    <div class="settings-item-icon"></div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Dark Mode</div>
                        <div class="settings-item-value" id="dark-mode-value">Auto</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="dark-mode" onchange="toggleDarkMode(this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-item">
                    <div class="settings-item-icon"></div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">3D Buildings</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="show-3d-buildings" onchange="saveSetting('show3DBuildings', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-item">
                    <div class="settings-item-icon"></div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Traffic Layer</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="show-traffic" onchange="toggleTrafficLayer(this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-item">
                    <div class="settings-item-icon"></div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Speed Limit Display</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="show-speed-limit" onchange="saveSetting('showSpeedLimit', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <!-- Sound Section -->
            <div class="settings-section">
                <div class="settings-section-title">Sound & Voice</div>
                <div class="settings-item">
                    <div class="settings-item-icon"></div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Voice Guidance</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="voice-guidance" checked onchange="saveSetting('voiceGuidance', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-item">
                    <div class="settings-item-icon"></div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Alert Sounds</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="alert-sounds" checked onchange="saveSetting('alertSounds', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <!-- Battery Section -->
            <div class="settings-section">
                <div class="settings-section-title">Battery & Data</div>
                <div class="settings-item">
                    <div class="settings-item-icon"></div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Battery Saver</div>
                        <div class="settings-item-value">Dims screen during navigation</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="battery-saver" onchange="saveSetting('batterySaver', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-item">
                    <div class="settings-item-icon"></div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Offline Maps</div>
                        <div class="settings-item-value">Download maps for offline use</div>
                    </div>
                    <div class="settings-item-arrow"></div>
                </div>
            </div>

            <!-- Data Management Section -->
            <div class="settings-section">
                <div class="settings-section-title">Data Management</div>
                <div class="settings-item" onclick="clearRecentSearches()">
                    <div class="settings-item-icon"></div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Clear Recent Searches</div>
                    </div>
                    <div class="settings-item-arrow"></div>
                </div>
                <div class="settings-item" onclick="clearAllData()">
                    <div class="settings-item-icon"></div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Clear All Data</div>
                        <div class="settings-item-value">Reset app to defaults</div>
                    </div>
                    <div class="settings-item-arrow"></div>
                </div>
            </div>

            <!-- About Section -->
            <div class="settings-section">
                <div class="settings-section-title">About</div>
                <div class="settings-item">
                    <div class="settings-item-icon"></div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Version</div>
                        <div class="settings-item-value">2.0.0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast notification -->
    <div class="toast" id="toast"></div>

    <!-- Scripts -->
    <script>
        // Load MapLibre then app
        (function() {
            var maplibreScript = document.createElement('script');
            maplibreScript.src = 'https://unpkg.com/maplibre-gl@4.1.0/dist/maplibre-gl.js';
            maplibreScript.async = true;
            maplibreScript.onload = function() {
                var appScript = document.createElement('script');
                appScript.src = 'js/maps.min.js?v=32';
                appScript.async = true;
                document.body.appendChild(appScript);
            };
            document.body.appendChild(maplibreScript);
        })();
    </script>

    <!-- Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                setTimeout(() => {
                    navigator.serviceWorker.register('/sw.js')
                        .then(reg => console.log('[SW] Registered'))
                        .catch(err => console.log('[SW] Failed:', err));
                }, 2000);
            });
        }
    </script>
</body>
</html>
